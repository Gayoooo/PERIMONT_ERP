#ui/screens/personnel_screen.py

import customtkinter as ctk
from tkinter import ttk
from database.db_manager import Database
from config.settings import *

class PersonnelScreen(ctk.CTkFrame):
    def __init__(self, parent):
        super().__init__(parent, fg_color="transparent")
        self.db = Database()
        self.setup_ui()

    def setup_ui(self):
        ctk.CTkLabel(self, text="Gestion du Personnel", font=("Segoe UI", 24, "bold")).pack(pady=10)
        
        container = ctk.CTkFrame(self, fg_color="transparent")
        container.pack(fill="both", expand=True, padx=20)

        # Formulaire
        form = ctk.CTkFrame(container, fg_color=COLOR_CARD_BG, width=300)
        form.pack(side="left", fill="y", padx=10)
        
        self.ent_mat = ctk.CTkEntry(form, placeholder_text="Matricule")
        self.ent_mat.pack(pady=10, padx=20)
        self.ent_nom = ctk.CTkEntry(form, placeholder_text="Nom Complet")
        self.ent_nom.pack(pady=10, padx=20)
        self.ent_sal = ctk.CTkEntry(form, placeholder_text="Salaire de Base")
        self.ent_sal.pack(pady=10, padx=20)
        
        ctk.CTkButton(form, text="Ajouter", fg_color=COLOR_ACCENT, command=self.add_emp).pack(pady=20)

        # Tableau
        self.tree = ttk.Treeview(container, columns=("mat", "nom", "sal"), show="headings")
        self.tree.heading("mat", text="MATRICULE")
        self.tree.heading("nom", text="NOM")
        self.tree.heading("sal", text="SALAIRE")
        self.tree.pack(side="right", fill="both", expand=True)
        self.load_data()

    def add_emp(self):
        self.db.query("INSERT INTO personnel (matricule, nom, salaire_base) VALUES (?,?,?)",
                     (self.ent_mat.get(), self.ent_nom.get(), self.ent_sal.get()))
        self.load_data()

    def load_data(self):
        for i in self.tree.get_children(): self.tree.delete(i)
        for r in self.db.query("SELECT * FROM personnel").fetchall():
            self.tree.insert("", "end", values=(r['matricule'], r['nom'], r['salaire_base']))